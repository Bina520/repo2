<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini App</title>
    <script src="https://unpkg.com/react/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const ShowAdButton = () => {
            React.useEffect(() => {
                if (window.show_8469379) {
                    return;
                }

                const tag = document.createElement('script');
                tag.src = '//doakosteceet.net/act/files/tag.min.js';
                tag.dataset.zone = '8469379';
                tag.dataset.sdk = 'show_8469379';

                document.body.appendChild(tag);
            }, []);

            const showAd = () => {
                show_8469379().then(() => {
                    // add here the function that should be executed after viewing the ad
                    document.getElementById('content').style.display = 'block';
                });
            };

            return <button onClick={showAd}>Show ad</button>;
        };

        class App extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    link: new URLSearchParams(window.location.search).get('link'),
                    content: null,
                    showAd: true
                };
            }

            componentDidMount() {
                if (this.state.link) {
                    fetch(this.state.link)
                        .then(response => response.text())
                        .then(data => this.setState({ content: data }));
                }
            }

            handleAdClose = () => {
                this.setState({ showAd: false });
            }

            render() {
                return (
                    <div>
                        {this.state.showAd ? (
                            <div>
                                <h2>Watch this ad to continue</h2>
                                <ShowAdButton />
                            </div>
                        ) : (
                            <div id="content" style={{ display: 'none' }} dangerouslySetInnerHTML={{ __html: this.state.content }} />
                        )}
                    </div>
                );
            }
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
